# üî• –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Freemium —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üö® –ü—Ä–æ–±–ª–µ–º–∞
- Free trial —Å—á–µ—Ç—á–∏–∫ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ó–∞–ø–∏—Å–∏ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `daily_free_analyses`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–æ–≤

## ‚úÖ –†–ï–®–ï–ù–ò–ï (—Å–ª–µ–¥—É–π –ø–æ –ø–æ—Ä—è–¥–∫—É)

---

## üìù –®–ê–ì 1: SQL –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ Supabase (10 –º–∏–Ω—É—Ç)

### 1.1. –û—Ç–∫—Ä–æ–π Supabase Dashboard

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç **TrendXL 2.0**
3. –û—Ç–∫—Ä–æ–π **SQL Editor** (–∏–∫–æ–Ω–∫–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —Å–ª–µ–≤–∞)

### 1.2. –í—ã–ø–æ–ª–Ω–∏ —Å–∫—Ä–∏–ø—Ç

1. –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª `QUICK_FIX_SUPABASE_FREEMIUM.sql` (—Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω)
2. –°–∫–æ–ø–∏—Ä—É–π **–í–ï–°–¨** –∫–æ–¥
3. –í—Å—Ç–∞–≤—å –≤ SQL Editor
4. **–í–ê–ñ–ù–û:** –ù–∞–π–¥–∏ —Å—Ç—Ä–æ–∫—É 224:
   ```sql
   WHERE email LIKE '%timolast%'  -- ‚¨ÖÔ∏è –ò–ó–ú–ï–ù–ò –ù–ê –°–í–û–ô EMAIL
   ```
5. –ò–∑–º–µ–Ω–∏ –Ω–∞ —á–∞—Å—Ç—å —Ç–≤–æ–µ–≥–æ email (–Ω–∞–ø—Ä–∏–º–µ—Ä `'%myemail%'`)
6. –ù–∞–∂–º–∏ **Run** (–∏–ª–∏ Ctrl+Enter)

### 1.3. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
```
‚úÖ –ß–∞—Å—Ç—å 1: RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
‚úÖ –ß–∞—Å—Ç—å 2: –§—É–Ω–∫—Ü–∏–∏ PostgreSQL –æ–±–Ω–æ–≤–ª–µ–Ω—ã
‚úÖ –í–°–Å –†–ê–ë–û–¢–ê–ï–¢!
```

–ï—Å–ª–∏ –≤–∏–¥–∏—à—å `‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω` - –ø—Ä–æ–≤–µ—Ä—å email –≤ —Å—Ç—Ä–æ–∫–µ 224.

---

## üîë –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel (5 –º–∏–Ω—É—Ç)

### 2.1. –û—Ç–∫—Ä–æ–π Vercel Dashboard

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ https://vercel.com/dashboard
2. –í—ã–±–µ—Ä–∏ –ø—Ä–æ–µ–∫—Ç **trendxl-2-0**
3. –û—Ç–∫—Ä–æ–π **Settings** ‚Üí **Environment Variables**

### 2.2. –ù–∞–π–¥–∏ SUPABASE_SERVICE_KEY

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:** –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è **`SUPABASE_SERVICE_KEY`**

#### ‚ùå –ï—Å–ª–∏ –µ—ë –ù–ï–¢:

1. –í–µ—Ä–Ω–∏—Å—å –≤ **Supabase Dashboard**
2. –û—Ç–∫—Ä–æ–π **Settings** ‚Üí **API**
3. –ù–∞–π–¥–∏ —Å–µ–∫—Ü–∏—é **Project API keys**
4. –°–∫–æ–ø–∏—Ä—É–π **`service_role` (secret)** –∫–ª—é—á ‚ö†Ô∏è –ù–ï anon key!
5. –í–µ—Ä–Ω–∏—Å—å –≤ Vercel ‚Üí Add Environment Variable:
   - **Name:** `SUPABASE_SERVICE_KEY`
   - **Value:** (–≤—Å—Ç–∞–≤—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á)
   - **Environment:** Production, Preview, Development (–≤—Å–µ 3!)
6. –°–æ—Ö—Ä–∞–Ω–∏

#### ‚úÖ –ï—Å–ª–∏ –æ–Ω–∞ –ï–°–¢–¨:

1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∫–ª—é—á –¥–ª–∏–Ω–Ω—ã–π (~250+ —Å–∏–º–≤–æ–ª–æ–≤)
2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `eyJ...`
3. –ï—Å–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–π - —ç—Ç–æ ANON key, –∑–∞–º–µ–Ω–∏ –Ω–∞ SERVICE_KEY (—Å–º. –≤—ã—à–µ)

### 2.3. –ü—Ä–æ–≤–µ—Ä—å –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- ‚úÖ `SUPABASE_URL` - https://xxx.supabase.co
- ‚úÖ `SUPABASE_KEY` - anon public key
- ‚úÖ `SUPABASE_SERVICE_KEY` - service role key (secret)
- ‚úÖ `JWT_SECRET`
- ‚úÖ `STRIPE_API_KEY`

---

## üöÄ –®–ê–ì 3: –ü–µ—Ä–µ–¥–µ–ø–ª–æ–π –Ω–∞ Vercel (3 –º–∏–Ω—É—Ç—ã)

### 3.1. –ï—Å–ª–∏ —Ç—ã –ò–ó–ú–ï–ù–ò–õ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel:

```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–æ–µ–∫—Ç–∞
git add -A
git commit -m "fix: update environment variables"
git push origin main
```

### 3.2. –ò–ª–∏ —Ñ–æ—Ä—Å–∏—Ä—É–π —Ä–µ–¥–µ–ø–ª–æ–π:

1. –í Vercel Dashboard ‚Üí Deployments
2. –ù–∞–π–¥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π
3. –ù–∞–∂–º–∏ "..." ‚Üí **Redeploy**
4. –ü–æ–¥–æ–∂–¥–∏ 2-3 –º–∏–Ω—É—Ç—ã –ø–æ–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è

---

## üß™ –®–ê–ì 4: –¢–ï–°–¢ (5 –º–∏–Ω—É—Ç)

### 4.1. –†—É—á–Ω–æ–π —Ç–µ—Å—Ç –≤ Supabase

–û—Ç–∫—Ä–æ–π **Supabase SQL Editor** –∏ –≤—ã–ø–æ–ª–Ω–∏:

```sql
-- –ü–æ–ª—É—á–∏ —Å–≤–æ–π UUID
SELECT id, email FROM auth.users WHERE email LIKE '%—Ç–≤–æ–π_email%';

-- –ó–∞–º–µ–Ω–∏ UUID_–°–Æ–î–ê –Ω–∞ —Å–≤–æ–π UUID –∏ –≤—ã–ø–æ–ª–Ω–∏:
SELECT * FROM public.get_free_trial_info('UUID_–°–Æ–î–ê');

-- –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
-- can_use_today: true (–∏–ª–∏ false –µ—Å–ª–∏ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª)
-- today_count: 0 (–∏–ª–∏ 1)
-- daily_limit: 1
-- message: "You have 1 free analysis available today"
```

### 4.2. –¢–µ—Å—Ç –Ω–∞ —Å–∞–π—Ç–µ

1. –û—Ç–∫—Ä–æ–π —Å–≤–æ–π —Å–∞–π—Ç (Vercel URL)
2. –í–æ–π–¥–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç
3. **–ü—Ä–æ–≤–µ—Ä—å —Å—á–µ—Ç—á–∏–∫** - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å `1/1 Free Today` (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π)
4. –í–≤–µ–¥–∏ —Å—Å—ã–ª–∫—É –Ω–∞ TikTok –ø—Ä–æ—Ñ–∏–ª—å
5. –ó–∞–ø—É—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑
6. **–ü–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞** —Å—á–µ—Ç—á–∏–∫ –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å `0/1 Used Today` (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
7. –ü–æ–ø—Ä–æ–±—É–π –≤–≤–µ—Å—Ç–∏ –µ—â–µ —Ä–∞–∑ ‚Üí –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞ **Subscribe**

### 4.3. –ü—Ä–æ–≤–µ—Ä—å —Ç–∞–±–ª–∏—Ü—É

–í Supabase SQL Editor:

```sql
SELECT * FROM public.daily_free_analyses 
ORDER BY created_at DESC 
LIMIT 5;
```

–î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å—å —Å:
- `user_id` = —Ç–≤–æ–π UUID
- `analysis_date` = —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞
- `analysis_count` = 1
- `profile_analyzed` = –∏–º—è –ø—Ä–æ—Ñ–∏–ª—è

---

## üêõ TROUBLESHOOTING

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Function does not exist"

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–µ—Ä–Ω–∏—Å—å –∫ –®–ê–ì 1
2. –£–±–µ–¥–∏—Å—å —á—Ç–æ –í–°–ï 3 —á–∞—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å –≤ SQL Editor:
   ```sql
   SELECT routine_name FROM information_schema.routines 
   WHERE routine_name IN ('can_use_free_trial', 'record_free_trial_usage', 'get_free_trial_info');
   ```
   –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –≤—Å–µ 3 —Ñ—É–Ω–∫—Ü–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "RLS policy violation"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `SUPABASE_SERVICE_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Vercel
2. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ Vercel - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ```
   ‚úÖ Supabase client initialized (using SERVICE_KEY)
   ```
3. –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `using ANON_KEY` ‚Üí –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω SERVICE_KEY

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –¢–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π Vercel ‚Üí Logs
2. –°–¥–µ–ª–∞–π –∞–Ω–∞–ª–∏–∑ –Ω–∞ —Å–∞–π—Ç–µ
3. –ò—â–∏ –≤ –ª–æ–≥–∞—Ö:
   - `üéØ Attempting to record free trial` ‚úÖ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
   - `‚ùå Failed to record free trial` ‚ùå –µ—Å—Ç—å –æ—à–∏–±–∫–∞
4. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - –ø—Ä–æ–≤–µ—Ä—å —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –∏ –ø—Ä–∏–º–µ–Ω–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –°—á–µ—Ç—á–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—á–∏—Å—Ç–∏ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Delete)
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. –í—ã–π–¥–∏ –∏ –≤–æ–π–¥–∏ –∑–∞–Ω–æ–≤–æ
4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –±–µ–∫–µ–Ω–¥ –≤–µ—Ä–Ω—É–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
   - –û—Ç–∫—Ä–æ–π Developer Tools (F12)
   - –í–∫–ª–∞–¥–∫–∞ Network
   - –°–¥–µ–ª–∞–π –¥–µ–π—Å—Ç–≤–∏–µ
   - –ù–∞–π–¥–∏ –∑–∞–ø—Ä–æ—Å `/api/v1/free-trial/info`
   - –ü—Ä–æ–≤–µ—Ä—å Response

---

## ‚úÖ –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –°–ü–ò–°–û–ö

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—å "–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç", —É–±–µ–¥–∏—Å—å:

- [ ] ‚úÖ SQL —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –ë–ï–ó –æ—à–∏–±–æ–∫ –≤ Supabase
- [ ] ‚úÖ `SUPABASE_SERVICE_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Vercel
- [ ] ‚úÖ Vercel –∑–∞–≤–µ—Ä—à–∏–ª –¥–µ–ø–ª–æ–π (–∑–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞)
- [ ] ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `daily_free_analyses` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] ‚úÖ –§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã (3 —à—Ç—É–∫–∏)
- [ ] ‚úÖ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã (4 —à—Ç—É–∫–∏)
- [ ] ‚úÖ –†—É—á–Ω–æ–π —Ç–µ—Å—Ç –≤ SQL Editor —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] ‚úÖ –õ–æ–≥–∏ Vercel –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "using SERVICE_KEY"
- [ ] ‚úÖ –ö—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –æ—á–∏—â–µ–Ω

---

## üìä –û–ñ–ò–î–ê–ï–ú–û–ï –ü–û–í–ï–î–ï–ù–ò–ï

### –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–¥–µ–Ω—å 1):
1. –í–∏–¥–∏—Ç: `1/1 Free Today` (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –±–ª–æ–∫)
2. –î–µ–ª–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ ‚Üí —É—Å–ø–µ—à–Ω–æ
3. –í–∏–¥–∏—Ç: `0/1 Used Today, Resets in 12h 30m` (–æ—Ä–∞–Ω–∂–µ–≤—ã–π –±–ª–æ–∫)
4. –ü—ã—Ç–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –µ—â–µ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **Subscribe Now**

### –¢–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–¥–µ–Ω—å 2):
1. –í–∏–¥–∏—Ç: `1/1 Free Today` (—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –±–ª–æ–∫)
2. –°—á–µ—Ç—á–∏–∫ —Å–±—Ä–æ—Å–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ 00:00 UTC

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–æ–¥–ø–∏—Å–∫–æ–π:
1. –í–∏–¥–∏—Ç: `‚ú® Premium Active - Unlimited Scans` (–∑–µ–ª–µ–Ω—ã–π –±–ª–æ–∫)
2. –ú–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –∞–Ω–∞–ª–∏–∑–æ–≤
3. –°—á–µ—Ç—á–∏–∫ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

---

## üÜò –ï–°–õ–ò –ù–ò–ß–ï–ì–û –ù–ï –ü–û–ú–û–ì–õ–û

–ù–∞–ø–∏—à–∏ –º–Ω–µ:
1. **–°–∫—Ä–∏–Ω—à–æ—Ç** Vercel Environment Variables (–∑–∞–∫—Ä–æ–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏!)
2. **–°–∫—Ä–∏–Ω—à–æ—Ç** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ SQL –≤ Supabase:
   ```sql
   SELECT * FROM public.daily_free_analyses LIMIT 5;
   SELECT routine_name FROM information_schema.routines 
   WHERE routine_name LIKE '%free%';
   ```
3. **–õ–æ–≥ –∏–∑ Vercel** –ø–æ—Å–ª–µ –ø–æ–ø—ã—Ç–∫–∏ –∞–Ω–∞–ª–∏–∑–∞ (Functions ‚Üí Logs)
4. **–°–∫—Ä–∏–Ω—à–æ—Ç** Developer Tools ‚Üí Network ‚Üí `/api/v1/analyze` (Response)

---

**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 20-30 –º–∏–Ω—É—Ç  
**–î–∞—Ç–∞:** 6 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL

