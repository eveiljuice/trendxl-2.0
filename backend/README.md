# TrendXL 2.0 Backend

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Python –±—ç–∫–µ–Ω–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ TikTok —Ç—Ä–µ–Ω–¥–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π Ensemble Data API –∏ OpenAI GPT-4.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π TikTok**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ –∏—Ö –ø–æ—Å—Ç–∞—Ö
- **–ò–ò-–∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ö–µ—à—Ç–µ–≥–æ–≤ —Å –ø–æ–º–æ—â—å—é GPT-4
- **–ü–æ–∏—Å–∫ —Ç—Ä–µ–Ω–¥–æ–≤**: –ü–æ–∏—Å–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–∏–¥–µ–æ –ø–æ —Ö–µ—à—Ç–µ–≥–∞–º
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å Redis
- **Rate Limiting**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π API
- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API**: Swagger/OpenAPI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **FastAPI**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è API
- **Ensemble Data SDK**: TikTok API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **OpenAI API**: GPT-4 –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **Redis**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **Pydantic**: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
- **Uvicorn**: ASGI —Å–µ—Ä–≤–µ—Ä

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Redis Server
- Ensemble Data API Token
- OpenAI API Key

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd backend
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª:

```env
# API Keys
ENSEMBLE_API_TOKEN=your_ensemble_data_token_here
OPENAI_API_KEY=your_openai_api_key_here

# Server Configuration
HOST=0.0.0.0
PORT=8000
DEBUG=True

# Redis Configuration
REDIS_URL=redis://localhost:6379
```

### 3. –ó–∞–ø—É—Å–∫ Redis (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

```bash
# Using Docker
docker run -d -p 6379:6379 redis:7-alpine

# Or install locally on Ubuntu/Debian
sudo apt update
sudo apt install redis-server
sudo systemctl start redis-server
```

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
python run_server.py
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:8000`

## üê≥ Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å Docker Compose

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ó–∞–ø—É—Å–∫ —Å Redis GUI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
docker-compose --profile tools up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –¢–æ–ª—å–∫–æ API —Å–µ—Ä–≤–∏—Å

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t trendxl-backend .

# –ó–∞–ø—É—Å–∫ (—Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–∏–π Redis)
docker run -d -p 8000:8000 --env-file .env trendxl-backend
```

## üìö API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `POST /api/v1/analyze` - –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ –ø—Ä–æ—Ñ–∏–ª—è
- `POST /api/v1/profile` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ñ–∏–ª–µ
- `POST /api/v1/posts` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/v1/hashtag/search` - –ü–æ–∏—Å–∫ –ø–æ —Ö–µ—à—Ç–µ–≥–∞–º
- `POST /api/v1/users/search` - –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –°–ª—É–∂–µ–±–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `GET /health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞
- `GET /api/v1/cache/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
- `POST /api/v1/cache/clear` - –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`
- OpenAPI Schema: `http://localhost:8000/openapi.json`

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ –ø—Ä–æ—Ñ–∏–ª—è

```bash
curl -X POST "http://localhost:8000/api/v1/analyze" \
  -H "Content-Type: application/json" \
  -d '{"profile_url": "https://www.tiktok.com/@username"}'
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

```bash
curl -X POST "http://localhost:8000/api/v1/profile" \
  -H "Content-Type: application/json" \
  -d '{"username": "username"}'
```

### –ü–æ–∏—Å–∫ –ø–æ —Ö–µ—à—Ç–µ–≥—É

```bash
curl -X POST "http://localhost:8000/api/v1/hashtag/search" \
  -H "Content-Type: application/json" \
  -d '{
    "hashtag": "trending",
    "count": 10,
    "period": 7,
    "sorting": 1
  }'
```

## üîç –ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ TikTok
2. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤**: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 20 –ø–æ—Å—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–ò–ò-–∞–Ω–∞–ª–∏–∑**: GPT-4 –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Å—Ç—ã –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç 5 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ö–µ—à—Ç–µ–≥–æ–≤
4. **–ü–æ–∏—Å–∫ —Ç—Ä–µ–Ω–¥–æ–≤**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö–µ—à—Ç–µ–≥–∞ –∏—â—É—Ç—Å—è –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
5. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –û—Ç–±–∏—Ä–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (> 1000 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤)
6. **–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏

## üö¶ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ª–∏–º–∏—Ç—ã

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–ü—Ä–æ—Ñ–∏–ª–∏**: 30 –º–∏–Ω—É—Ç
- **–ü–æ—Å—Ç—ã**: 15 –º–∏–Ω—É—Ç
- **–¢—Ä–µ–Ω–¥—ã**: 5 –º–∏–Ω—É—Ç

### Rate Limiting

- 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP –∞–¥—Ä–µ—Å
- –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Retry Logic

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö API
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- Rate limiting –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ API –∫–ª—é—á–µ–π
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check

```bash
curl http://localhost:8000/health
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞

```bash
curl http://localhost:8000/api/v1/cache/stats
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è development/production
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ API –≤—ã–∑–æ–≤–æ–≤ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pytest --cov=.

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è
pytest tests/test_ensemble_service.py
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config.py` –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- `ENSEMBLE_API_TOKEN` - —Ç–æ–∫–µ–Ω Ensemble Data API
- `OPENAI_API_KEY` - –∫–ª—é—á OpenAI API
- `REDIS_URL` - URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
- `MAX_REQUESTS_PER_MINUTE` - –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
- `CACHE_PROFILE_TTL` - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π (—Å–µ–∫)

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ Docker
docker-compose logs -f api

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
export DEBUG=True
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å Redis

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis
redis-cli ping

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–ª—é—á–µ–π –∫—ç—à–∞
redis-cli keys "trendxl:v2:*"
```

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞–º–∏
- Load balancer –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- Redis Cluster –¥–ª—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫—ç—à–∞
- Monitoring –∏ alerting —Å Prometheus/Grafana

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ main.py              # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ models.py            # Pydantic –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ utils.py             # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ ensemble_service.py
‚îÇ   ‚îú‚îÄ‚îÄ openai_service.py
‚îÇ   ‚îú‚îÄ‚îÄ cache_service.py
‚îÇ   ‚îî‚îÄ‚îÄ trend_analysis_service.py
‚îú‚îÄ‚îÄ tests/               # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª–∏ –≤ `models.py`
2. –î–æ–±–∞–≤–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å
3. –°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ `main.py`
4. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª LICENSE –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ API –∫–ª—é—á–µ–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Redis
4. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
