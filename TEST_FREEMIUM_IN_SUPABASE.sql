-- ============================================================================
-- –ü–†–û–í–ï–†–ö–ê: –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ freemium —Å–∏—Å—Ç–µ–º–∞ –≤ Supabase
-- –í—ã–ø–æ–ª–Ω–∏ —ç—Ç–æ –ü–û–°–õ–ï –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
-- ============================================================================

-- –®–∞–≥ 1: –ù–∞–π–¥–∏ —Å–≤–æ–π UUID (–∏–∑–º–µ–Ω–∏ email!)
SELECT 
    id as user_uuid,
    email,
    created_at
FROM auth.users
WHERE email LIKE '%timolast%'  -- ‚¨ÖÔ∏è –ò–ó–ú–ï–ù–ò –ù–ê –°–í–û–ô EMAIL
LIMIT 1;

-- üëÜ –°–ö–û–ü–ò–†–£–ô UUID –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã—à–µ –∏ –≤—Å—Ç–∞–≤—å –µ–≥–æ –Ω–∏–∂–µ –≤–º–µ—Å—Ç–æ 'YOUR_UUID_HERE'

-- ============================================================================
-- –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏—é get_free_trial_info
-- ============================================================================

SELECT * FROM public.get_free_trial_info('YOUR_UUID_HERE');

-- ‚úÖ –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
-- can_use_today: true (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–µ–≥–æ–¥–Ω—è) –∏–ª–∏ false
-- today_count: 0 –∏–ª–∏ 1
-- daily_limit: 1
-- has_subscription: false (–µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏)
-- message: "You have 1 free analysis available today"

-- ============================================================================
-- –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏—é can_use_free_trial
-- ============================================================================

SELECT public.can_use_free_trial('YOUR_UUID_HERE') as can_use;

-- ‚úÖ –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: true (–µ—Å–ª–∏ –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å) –∏–ª–∏ false

-- ============================================================================
-- –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ
-- ============================================================================

SELECT 
    user_id,
    analysis_date,
    analysis_count,
    profile_analyzed,
    last_analysis_timestamp,
    created_at
FROM public.daily_free_analyses
WHERE user_id = 'YOUR_UUID_HERE'
ORDER BY analysis_date DESC
LIMIT 5;

-- ‚úÖ –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–≤–æ–∏ –∑–∞–ø–∏—Å–∏ (–µ—Å–ª–∏ —É–∂–µ –¥–µ–ª–∞–ª –∞–Ω–∞–ª–∏–∑)
-- –ò–ª–∏ –±—ã—Ç—å –ø—É—Å—Ç—ã–º (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –¥–µ–ª–∞–ª)

-- ============================================================================
-- –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å –ø–æ–ª–∏—Ç–∏–∫–∏ RLS
-- ============================================================================

SELECT 
    schemaname,
    tablename,
    policyname,
    cmd,
    roles,
    qual,
    with_check
FROM pg_policies
WHERE tablename = 'daily_free_analyses'
ORDER BY policyname;

-- ‚úÖ –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 4 –ø–æ–ª–∏—Ç–∏–∫–∏:
-- 1. "Allow insert for authenticated users"
-- 2. "Allow update for authenticated users"
-- 3. "Service role has full access"
-- 4. "Users can view their own analyses"

-- ============================================================================
-- –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
-- ============================================================================

SELECT 
    routine_name,
    routine_type,
    data_type as return_type
FROM information_schema.routines
WHERE routine_schema = 'public'
AND routine_name IN ('can_use_free_trial', 'record_free_trial_usage', 'get_free_trial_info')
ORDER BY routine_name;

-- ‚úÖ –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ 3 —Ñ—É–Ω–∫—Ü–∏–∏

-- ============================================================================
-- –®–∞–≥ 7: –¢–ï–°–¢–û–í–ê–Ø –ó–ê–ü–ò–°–¨ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
-- ============================================================================

-- –¢–û–õ–¨–ö–û –î–õ–Ø –¢–ï–°–¢–ê! –°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å
-- –†–ê–°–ö–û–ú–ú–ï–ù–¢–ò–†–£–ô –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å:

-- SELECT public.record_free_trial_usage('YOUR_UUID_HERE', 'test_profile_manual');

-- –ü–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∑–∞–ø–∏—Å—å –ø–æ—è–≤–∏–ª–∞—Å—å:
-- SELECT * FROM public.daily_free_analyses WHERE user_id = 'YOUR_UUID_HERE';

-- ============================================================================
-- ‚úÖ –ï–°–õ–ò –í–°–Å –†–ê–ë–û–¢–ê–ï–¢:
-- 1. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel (SUPABASE_SERVICE_KEY)
-- 2. –ó–∞–∫–æ–º–º–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è: git commit + git push
-- 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –Ω–∞ —Å–∞–π—Ç–µ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
-- ============================================================================

